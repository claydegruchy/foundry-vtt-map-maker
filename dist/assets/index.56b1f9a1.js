var Ce=Object.defineProperty,Te=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var _=(e,t,o)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,h=(e,t)=>{for(var o in t||(t={}))Le.call(t,o)&&_(e,o,t[o]);if(A)for(var o of A(t))Re.call(t,o)&&_(e,o,t[o]);return e},u=(e,t)=>Te(e,De(t));import{v as w,j as T,L as j,r as z,R as p,S as Ee,a as b,b as W,T as Pe,g as S,p as Fe,u as Oe,c as Ae,d as _e,e as je}from"./vendor.1dde2e33.js";const ze=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}};ze();const M="tvfbchicbrvuctrvjcdvbdlncfndfuti",N=!0,I=0,U="",V=null,X=null,Y=4e3,Z=3e3,B=.25,G=null,H="#999999",K=1,q=100,$=0,J=0,Q="#000000",ee=.2,te=5,oe="m",re=!0,ne=!0,se=1642085325452,le=!1,ae=null,ie=0,de=[],ce=[],ge=[],he=[],ue=[],fe=[],pe=[],me=[{_id:"FxVCQxnM7uLTIu6E",c:[5e3,800,5e3,900],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}},{_id:"Tyqn0PnGL3uvoH0m",c:[100,0,100,100],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}},{_id:"rT6TrSUrPWLXOnt4",c:[400,0,400,200],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}},{_id:"0skYZyox0L4fKfhz",c:[700,0,700,500],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}},{_id:"c80O1z1NBoiUo1Bx",c:[0,1e3,100,1e3],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}},{_id:"Ma5x2kDSEZDOzi0y",c:[0,1300,300,1300],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}},{_id:"fTVwZNanPNIChrWz",c:[0,1600,600,1600],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}}],ye=null,ve=null,xe=null,ke="",we={"token-attacher":{},exportSource:{world:"test",system:"alienrpg",coreVersion:"9.242",systemVersion:"2.0.7"}};var We={name:M,navigation:N,navOrder:I,navName:U,img:V,foreground:X,width:Y,height:Z,padding:B,initial:G,backgroundColor:H,gridType:K,grid:q,shiftX:$,shiftY:J,gridColor:Q,gridAlpha:ee,gridDistance:te,gridUnits:oe,tokenVision:re,fogExploration:ne,fogReset:se,globalLight:le,globalLightThreshold:ae,darkness:ie,drawings:de,tokens:ce,lights:ge,notes:he,sounds:ue,templates:fe,tiles:pe,walls:me,playlist:ye,playlistSound:ve,journal:xe,weather:ke,flags:we},Me=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",name:M,navigation:N,navOrder:I,navName:U,img:V,foreground:X,width:Y,height:Z,padding:B,initial:G,backgroundColor:H,gridType:K,grid:q,shiftX:$,shiftY:J,gridColor:Q,gridAlpha:ee,gridDistance:te,gridUnits:oe,tokenVision:re,fogExploration:ne,fogReset:se,globalLight:le,globalLightThreshold:ae,darkness:ie,drawings:de,tokens:ce,lights:ge,notes:he,sounds:ue,templates:fe,tiles:pe,walls:me,playlist:ye,playlistSound:ve,journal:xe,weather:ke,flags:we,default:We}),v={fillColor:"#003300",strokeWidth:10,strokeColor:"#009933"},D={fill:"rgba(0,0,0,0.0)",stroke:"black",strokeWidth:8,strokeColor:"#009933"};const Ne=(e=4e3,t=3e3)=>[e*.5,t*.5],C=([e,t])=>{var[o,n]=Ne();return[e+o,t+n]},be={tile:({x:e,y:t})=>({_id:w(),img:"modules/ship-maker/textures/Grate_Metal_D_03_small.png",width:100,height:100,x:e,y:t,z:1,rotation:180,alpha:1,tint:null,hidden:!1,locked:!1,overhead:!1,occlusion:{mode:1,alpha:0},video:{loop:!0,autoplay:!0,volume:0},flags:{}}),wall:({xs:e,ys:t,xe:o,ye:n})=>({_id:w(),c:[e,t,o,n],light:20,move:20,sight:20,sound:20,dir:0,door:0,ds:0,flags:{}}),drawing:({points:e,texture:t})=>u(h({_id:w(),author:"HkYvsyS3L7U5KzuX",type:"p",x:0,y:0,rotation:0,z:0,points:e,bezierFactor:0,fillType:2},v),{fillAlpha:.5,strokeAlpha:2,texture:t,fontFamily:"Signika",fontSize:48,textColor:"#FFFFFF",textAlpha:1,hidden:!1,locked:!1,flags:{},text:""})},Ie=({walls:e,drawings:t})=>{var o=u(h({},Me),{name:w(),walls:e,drawings:t});return delete o.default,o},Ue=e=>{console.group("makewall");var t=e[0],o=[];return t.forEach((n,r)=>{var a=t[r],c=t[r+1];c||(c=t[0]),console.log(C([1,2]));var[i,f]=C(a),[g,d]=C(c),y=be.wall({xs:i,ys:f,xe:g,ye:d});o.push(y)}),console.groupEnd("makewall"),o},Ve=e=>{console.group("makeDrawing");var e=e[0];return e=e.map(t=>C(t)),console.groupEnd("makeDrawing"),be.drawing({points:e})},l=T.exports.jsx,m=T.exports.jsxs,L=T.exports.Fragment,Xe=({gridSize:e,area:t,scale:o})=>(console.log({gridSize:e}),Array.from({length:t*o}).map((n,r)=>m(L,{children:[l(j,{points:[r*e,0,r*e,t/o],stroke:"black",strokeWidth:.5}),l(j,{points:[0,r*e,t/o,r*e],stroke:"black",strokeWidth:.5})]}))),Ye=async e=>{const t="file",o=JSON.stringify(e,null,2),n=new Blob([o],{type:"application/json"}),r=await URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=t+".json",document.body.appendChild(a),a.click(),document.body.removeChild(a)},Ze=(e,t)=>{let o=[],n=e.size();console.log({size:n,scale:t}),console.log("getTransform",e.getTransform().m,"getAbsoluteTransform",e.getAbsoluteTransform().m,e.getAbsoluteScale(),e.getAbsolutePosition()),o[0]={x:0,y:0},o[1]={x:n.width,y:0},o[2]={x:n.width,y:n.height},o[4]={x:0,y:n.height},o[5]={x:0,y:0};var r=[];for(var a of o.filter(c=>c))r.push(e.getTransform().point(a));return r=r.map(({x:c,y:i})=>[c,i]),r};var Be=({points:e})=>l(_e,{sceneFunc:(t,o)=>{t.beginPath();for(var n of e)t.lineTo(...n);t.closePath(),t.fillStrokeShape(o)},fill:v.fillColor,stroke:v.strokeColor,strokeWidth:v.strokeWidth,points:e}),Ge=({features:e})=>{if(!e)return null;const t=({points:n})=>l(Be,{fill:v.fillColor,stroke:v.strokeColor,strokeWidth:v.strokeWidth,points:n});var o=n=>n;return e.geometry.type=="Polygon"?l(L,{children:l(t,{points:[...S(o(e))[0]]})}):e.geometry.type=="MultiPolygon"?l(L,{children:S(o(e)).map(n=>l(t,{points:[...n[0]]}))}):null};const R=(e,t)=>{var o=[];for(var n of e)o.push(Fe([Ze(n,t)],{fill:"#0f0"}));var r=o[0];for(var n of o.slice(1))r=Oe(r,n);return r},He=e=>{if(!!e){var t=[],o=[],n=(r,a)=>{console.group("addwall"),t=[...t,...Ue(r)],o=[...o,Ve(r)],console.groupEnd("addwall")};return e.geometry.type=="Polygon"&&n(S(e)),e.geometry.type=="MultiPolygon"&&S(e).forEach(r=>n(r)),Ie({walls:t,drawings:o})}},Se=({shapeProps:e,isSelected:t,onSelect:o,onChange:n,onClick:r,draggable:a=!0,transformEnd:c})=>{const i=p.useRef(),f=p.useRef();return p.useEffect(()=>{t&&(f.current.nodes([i.current]),f.current.getLayer().batchDraw())},[t]),m(p.Fragment,{children:[l(W,u(h({onClick:r||o,onTap:o,ref:i},e),{draggable:a,onKeyDown:g=>console.log(key),onDragStart:g=>n(u(h({},e),{strokeWidth:D.strokeWidth,x:g.target.x(),y:g.target.y()})),onDragEnd:g=>n(u(h({},e),{strokeWidth:0,x:g.target.x(),y:g.target.y()})),onTransformEnd:g=>{const d=i.current,y=d.scaleX(),s=d.scaleY();d.scaleX(1),d.scaleY(1),n(u(h({},e),{x:d.x(),y:d.y(),width:Math.max(5,d.width()*y),height:Math.max(d.height()*s)}))}})),t&&l(Ae,{ref:f,boundBoxFunc:(g,d)=>d.width<5||d.height<5?g:d})]})};var Ke={scale:.3,data:{gridSize:100,area:1e3}};const E=[{width:300,height:300,fill:"rgba(0,0,0,0.4)",id:"t1"},{width:150,height:600,fill:"rgba(0,0,0,0.4)",id:"t2"}],qe=[u(h({x:400,y:400,width:500,height:500},D),{id:"rect2"})],$e=e=>u(h(h({},e),D),{id:w()}),P=e=>e.getClassName()=="Rect";var Je={flex:1,backgroundColor:"silver",margin:5,padding:5,borderRadius:10,justifyContent:"center",textAlign:"center",width:"100%",display:"flex",alignItems:"center"},k=e=>l("div",{className:"control-box",style:u(h({},Je),{flex:e.flex}),children:e.children});const Qe=e=>{const[t,o]=z.exports.useState(),[n,r]=p.useState(qe),[a,c]=p.useState(null),[i,f]=p.useState(Ke),g=s=>{s.target===s.target.getStage()&&c(null)};var d=s=>f(u(h({},i),{scale:i.scale*s})),y=30;return l("div",{children:m("div",{style:{flexDirection:"row",alignItems:"stretch",display:"flex"},children:[m("div",{style:{flexDirection:"column",alignItems:"flex-start",display:"flex"},children:[m(k,{children:["Zoom: ",i.scale.toFixed(2)]}),l(k,{children:l("div",{onClick:s=>d(1.5),children:"Zoom In"})}),l(k,{children:l("div",{onClick:s=>d(.5),children:"Zoom Out"})}),l(k,{children:m("label",{children:["Grid size",l("input",{type:"number",min:50,onInput:s=>f(u(h({},i),{data:u(h({},i.data),{gridSize:s.target.value>0&&s.target.value||50})})),value:i.data.gridSize})]})}),l(k,{children:l("div",{onClick:s=>Ye(He(t)),children:"Export"})}),l(k,{flex:3,children:l("div",{style:{whiteSpace:"pre-wrap"},children:`This is a wysiwyg editor for Foundry VTT.

- Drag the outlined box (building component) to place a room. 

-  Click on a box in the toolbox to spawn a new building component.

-  Click on a placed building component to resize or rotate

- All touching components will merge into a single room. 
-  Hit export to get a Foundry VTT scene. 

-  Import the scene into Foundry. Add doors and other features from there.

Created by Clay D`})})]}),m(Ee,{scaleY:i.scale,scaleX:i.scale,style:{margin:30,borderStyle:"solid"},width:window.innerWidth/1.2,height:window.innerHeight/1.2,onMouseDown:g,onTouchStart:g,children:[l(b,{children:l(Ge,{features:t})}),l(b,{children:l(Xe,{scale:i.scale,gridSize:i.data.gridSize,area:i.data.area*4})}),m(b,{children:[l(W,{x:0,y:0,opacity:.5,width:Math.max(...E.map(s=>s.width))+30,height:E.map(s=>s.height).reduce((s,x)=>s+x,100),fill:"gray",cornerRadius:10}),l(Pe,{text:"Toolbox",fontSize:30,x:10,y:10}),E.map((s,x)=>(y+=10,s.y=y,s.x=10,y+=s.height,l(Se,{shapeProps:s,draggable:!1,onClick:F=>{r([...n,$e(s)])}},s.id)))]}),l(b,{onClick:s=>{o(R(s.currentTarget.getChildren(P),i.scale))},onDragStart:s=>{o(R(s.currentTarget.getChildren(P),i.scale))},onDragEnd:s=>{o(R(s.currentTarget.getChildren(P),i.scale))},children:n.map((s,x)=>l(Se,{shapeProps:s,isSelected:s.id===a,onSelect:()=>{c(s.id)},onChange:F=>{const O=n.slice();O[x]=F,r(O)}},x+"r"))})]},"edit")]})})};function et(){return z.exports.useState(0),l("div",{className:"App",children:l(Qe,{})})}je.render(l(p.StrictMode,{children:l(et,{})}),document.getElementById("root"));
